{% extends "layout.html" %}

{% macro take_key(key) -%}
    <form class="form-inline" action="{{ url_for("key_take", key_id=key.id) }}" method="POST">
        <input class="btn" type="submit" value="take">
    </form>
{%- endmacro %}

{% macro give_key(key, keyholders) -%}
    <form class="form-inline" action="{{ url_for("change_keyholder", key_id=key.id) }}" method="POST">
        <select name="keyholder_id">
            {% for keyholder in keyholders %}
            <option value="{{keyholder.id}}" {% if key.holder_id == keyholder.id %}selected{% endif %}>{{ keyholder }}</option>
            {% endfor %}
        </select>
        <input class="btn" type="submit" value="give">
    </form>
{%- endmacro %}

{% block title %}Key list{% endblock %}
{% block body %}
<div class="row-fluid">
    <h2>Key list</h2>
</div>
<div class="row-fluid">
    <div class="span9">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Key</th>
                <th>Keyholder</th>
                <th>Take</th>
                <th>Give</th>
            </tr>
            </thead>
            <tbody>
            {% for key in keys %}
            <tr>
                <td><a href="{{ url_for('key', key_id=key.id) }}">{{ key.name }}</a></td>
                <td>{{ key.holder or "" }}</td>
                <td>
            {% if g.user != key.holder and not g.user.is_keymanager %}
            {{ take_key(key) }}
            {% endif %}
                </td>
                <td>
            {% if g.user == key.holder or g.user.is_keymanager %}
                {{ give_key(key, keyholders) }}
            {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
